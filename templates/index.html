<!DOCTYPE html>
<html lang="en" class="antialiased">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>DB-Genie</title>

  <!-- Favicon links -->
  <link rel="icon" type="image/png" sizes="32x32" href="/static/images/Brand Product.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/images/Brand Product.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/images/Brand Product.png">
  <link rel="shortcut icon" href="/static/images/Brand Product.png">

  <!-- Optimized theme initialization - prevents FOUC -->
  <script>
    (function () {
      const theme = localStorage.getItem('theme') ||
        (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');

      document.documentElement.classList.toggle('dark', theme === 'dark');

      if (!localStorage.getItem('theme')) {
        localStorage.setItem('theme', theme);
      }
    })();
  </script>

  <!-- Critical resource preloading for performance -->
  <link rel="preload" href="/static/styles.css" as="style">
  <link rel="preload" href="/static/images/Brand Logo.png" as="image">
  <link rel="preload" href="/static/images/user.png" as="image">

  <!-- Critical CSS -->
  <link rel="stylesheet" href="/static/styles.css">

  <!-- Non-critical CSS with efficient loading -->
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css" as="style"
    onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css" as="style"
    onload="this.onload=null;this.rel='stylesheet'">

  <!-- Syntax highlighting with optimal loading -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/atom-one-dark.min.css">

  <!-- Fallback for preload -->
  <noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
  </noscript>
</head>

<!-- Using centralized theme classes for consistency -->

<body class="app-surface app-transition overflow-hidden">
  <div class="font-sans flex h-screen min-h-0">

    <!-- Sidebar Fragment -->
    {% include 'fragments/sidebar.html' %}

    <!-- SQL Editor Popup Fragment -->
    {% include 'fragments/sql_editor_popup.html' %}

    <!-- Main Content Area -->
    <main id="main-content"
      class="app-surface-secondary flex flex-col flex-grow overflow-hidden min-h-0 w-full md:ml-64 app-transition-slow">

      <!-- Header Fragment -->
      {% include 'fragments/header.html' %}

      <!-- Settings Modal Fragment -->
      {% include 'fragments/settings_modal.html' %}

      <!-- Main Chat Area Fragment -->
      {% include 'fragments/chat_area.html' %}

      <!-- Footer / Input Fragment -->
      {% include 'fragments/footer_input.html' %}

      <!-- Notification Area Fragment -->
      {% include 'fragments/notification_area.html' %}

      <!-- Query Result Modal Fragment -->
      {% include 'fragments/query_result_modal.html' %}

      <!-- DB Connection Modal Fragment -->
      {% include 'fragments/db_connection_modal.html' %}
    </main>

  </div>

  <!-- Optimized JavaScript loading strategy -->

  <!-- Critical CodeMirror resources -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/sql/sql.min.js"></script>
  <script defer
    src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closebrackets.min.js"></script>
  <script defer
    src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/matchbrackets.min.js"></script>
  <script defer
    src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/selection/active-line.min.js"></script>

  <!-- Non-critical resources loaded asynchronously -->
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js"></script>
  <script async src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script async src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>

  <!-- Highlight.js with language support -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/sql.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/json.min.js"></script>

  <!-- Main application script -->
  <script type="module" src="/static/script.js"></script>
</body>

</html>