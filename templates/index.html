<!DOCTYPE html>
<html lang="en" class="antialiased">

<head>
  <meta charset="UTF-8">
  <meta name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>DB-Genie</title>

  <!-- Favicon links -->
  <link rel="icon" type="image/png" sizes="32x32" href="/static/images/Brand Product.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static/images/Brand Product.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/static/images/Brand Product.png">
  <link rel="shortcut icon" href="/static/images/Brand Product.png">

  <!-- Theme initialization script - must run before CSS loads to prevent flash -->
  <script>
    (function () {
      // Get theme from localStorage or default to light
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const theme = savedTheme || (prefersDark ? 'dark' : 'light');

      // Apply theme immediately to prevent flash
      if (theme === 'dark') {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }

      // Store the theme if it wasn't already saved
      if (!savedTheme) {
        localStorage.setItem('theme', theme);
      }
    })();
  </script>

  <!-- Preload critical resources -->
  <link rel="preload" href="/static/styles.css" as="style">
  <link rel="preload" href="/static/images/Brand Logo.png" as="image">
  <link rel="preload" href="/static/images/Brand Product.png" as="image">
  <link rel="preload" href="/static/images/user.png" as="image">

  <!-- Critical CSS - Tailwind -->
  <link rel="stylesheet" href="/static/styles.css">

  <!-- Non-critical CSS - Load asynchronously -->
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css" as="style"
    onload="this.onload=null;this.rel='stylesheet'">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css" as="style"
    onload="this.onload=null;this.rel='stylesheet'"> <!-- Fallback for browsers that don't support preload -->
  <noscript>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
  </noscript>
</head>

<body class="bg-white dark:bg-neutral-900 text-neutral-900 dark:text-neutral-100 transition-colors duration-200">
  <div class="font-sans overflow-hidden flex h-screen text-base leading-relaxed min-h-0">
    <!-- Sidebar Fragment -->
    {% include 'fragments/sidebar.html' %}

    <!-- SQL Editor Popup Fragment -->
    {% include 'fragments/sql_editor_popup.html' %}

    <!-- Main Content -->
    <main id="main-content"
      class="bg-neutral-100 dark:bg-neutral-800 flex flex-col flex-grow overflow-hidden min-h-0 w-full md:ml-64 transition-all duration-300 ease-in-out">

      <!-- Header Fragment -->
      {% include 'fragments/header.html' %}

      <!-- Settings Modal Fragment -->
      {% include 'fragments/settings_modal.html' %}

      <!-- Main Chat Area Fragment -->
      {% include 'fragments/chat_area.html' %}

      <!-- Footer / Input Fragment -->
      {% include 'fragments/footer_input.html' %}

      <!-- Notification Area Fragment -->
      {% include 'fragments/notification_area.html' %}

      <!-- Query Result Modal Fragment -->
      {% include 'fragments/query_result_modal.html' %}
    </main>

  </div>

  <!-- Critical JavaScript loaded with defer for better performance -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/sql/sql.min.js"></script>
  <script defer
    src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closebrackets.min.js"></script>
  <script defer
    src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/matchbrackets.min.js"></script>
  <script defer
    src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/selection/active-line.min.js"></script>

  <!-- Non-critical JavaScript loaded asynchronously -->
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js"></script>
  <script async src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script async src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>

  <!-- Main application script -->
  <script type="module" src="/static/script.js"></script>
</body>

</html>